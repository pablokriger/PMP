<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PMP - Exam Prep</title>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Firebase SDKs MODULAR (v12.8.0) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getAuth,
    GoogleAuthProvider,
    onAuthStateChanged,
    signInWithPopup,
    signOut
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
  import {
    getFirestore,
    collection,
    getDocs,
    query,
    orderBy,
    addDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBWctc8V2t30ZX6B88xcfeljfaLfuK8ohM",
    authDomain: "cmp-exam-prep.firebaseapp.com",
    projectId: "cmp-exam-prep",
    storageBucket: "cmp-exam-prep.firebasestorage.app",
    messagingSenderId: "777953288024",
    appId: "1:777953288024:web:13f1413295d3f828340f2d"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const googleProvider = new GoogleAuthProvider();

  // Hacer disponibles globalmente para el resto del código
  window.auth = auth;
  window.db = db;
  window.googleProvider = googleProvider;
  window.onAuthStateChanged = onAuthStateChanged;
  window.signInWithPopup = signInWithPopup;
  window.signOut = signOut;
  window.getDocs = getDocs;
  window.collection = collection;
  window.query = query;
  window.orderBy = orderBy;
  window.addDoc = addDoc;
  window.serverTimestamp = serverTimestamp;
</script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
<header class="app-header">
  <div class="brand">
    <h1>Simulador de Examen PMP®</h1>
    <p class="lead">
      Preparación profesional alineada al PMBOK® 7 — práctica por dominios,
      examen completo y repaso.
    </p>
  </div>
  <div style="position:relative">
    <div class="header-buttons">
      <button class="fullscreen-btn" id="fullscreen-btn" aria-label="Pantalla completa" data-tooltip="Pantalla completa">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" id="fullscreen-icon"><path d="M7 7h4V5H5v6h2V7zm10 0h-4V5h6v6h-2V7zm-10 10v-4H5v6h6v-2H7zm10 0h-4v2h6v-6h-2v4z" fill="#27456e"/></svg>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" id="exit-fullscreen-icon" style="display:none"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z" fill="#27456e"/></svg>
      </button>
      <!-- Botón de idioma (globo terráqueo) -->
      <button class="lang-btn" id="lang-btn" aria-label="Idioma" data-tooltip="Idioma">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="12" cy="12" r="9" stroke="#27456e" stroke-width="1.2" fill="none"/>
          <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10A15.3 15.3 0 0112 2z" stroke="#27456e" stroke-width="1.2" fill="none"/>
        </svg>
      </button>
      <!-- Botón de inicio (casita) -->
      <button class="home-header-btn" id="home-header-btn" aria-label="Volver al inicio" data-tooltip="Inicio">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke="#27456e" stroke-width="1.2" fill="none"/>
          <path d="M9 22V12h6v10" stroke="#27456e" stroke-width="1.2" fill="none"/>
        </svg>
      </button>
      <!-- Botón del menú principal -->
      <div class="top-menu">
        <button id="menuBtn" class="hambtn" aria-label="Menú">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="3" y="5" width="18" height="2" rx="1" fill="#27456e"/><rect x="3" y="11" width="18" height="2" rx="1" fill="#27456e"/><rect x="3" y="17" width="18" height="2" rx="1" fill="#27456e"/></svg>
        </button>
        <div id="menuDropdown" class="menu-dropdown hidden">
          <!-- Usuario -->
          <div class="menu-section user-section">
            <img id="userAvatar" src="https://via.placeholder.com/48" alt="Usuario">
            <div>
              <div id="userName">Invitado</div>
              <button id="loginBtnMenu">Iniciar sesión</button>
              <button id="logoutBtnMenu" class="hidden">Cerrar sesión</button>
            </div>
          </div>
          <hr>
          <!-- Mi progreso -->
          <div class="menu-section">
            <button class="menu-link" id="progressMenuBtn">Mi progreso</button>
          </div>
          <hr>
          <!-- Consejos -->
          <div class="menu-section">
            <button class="menu-link" id="consejosMenuBtn">Consejos</button>
            <div id="consejosSubmenu" style="display: none;">
              <button class="menu-link tips-option" data-tip-type="consejos_PMP">Certificación PMP</button>
              <button class="menu-link tips-option" data-tip-type="pmbok7_caracteristicas">Sobre el PMBOK7</button>
            </div>
          </div>
          <hr>
          <!-- Acerca de -->
          <div class="menu-section about-section">
            <button class="menu-link" id="aboutMenuBtn">Acerca de</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Menú de idioma -->
    <div class="lang-menu-list" id="lang-menu-list" role="menu" aria-hidden="true">
      <button data-lang="es">Español</button>
      <button data-lang="en">English</button>
    </div>
  </div>
</header>
<div id="start-screen">
<div class="start-card">
<div class="hero"><img src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1200&q=80" alt="Estudio PMP"></div>
<div class="controls" aria-hidden="false">
<div><label style="font-weight:800;display:block;margin-bottom:4px;font-size:1rem;">Modalidad:</label>
<label><input type="radio" name="mode" value="exam" checked> Simulador Examen PMP (180q - 250')</label><br>
<label><input type="radio" name="mode" value="custom"> Personalizar examen</label>
<p id="exam-note" style="margin:6px 0 0 0;color:#27456e;font-size:0.85rem;">Se simula un examen real de 180 preguntas en 250 minutos (se incluyen dos posibles descansos de 10 minutos en el total).</p></div>
<div id="exam-controls" style="margin-top:6px"><div class="option-group"><label for="version-filter">Versión (solo para Exam PMP):</label><br>
<div class="version-buttons" id="exam-version-buttons"><button class="version-btn" data-value="v6">v6</button><button class="version-btn selected" data-value="v7">v7</button></div><input type="hidden" id="version-filter-exam" value="v7"></div></div>
<div id="custom-controls" style="margin-top:6px;display:none;border-top:1px dashed rgba(0,0,0,0.04);padding-top:6px">
<div class="option-group"><label style="font-weight:700;">Versión del examen:</label><br>
<div class="version-buttons" id="custom-version-buttons"><button class="version-btn selected" data-value="both">Ambas</button><button class="version-btn" data-value="v6">v6</button><button class="version-btn" data-value="v7">v7</button></div><input type="hidden" id="custom-version" value="both"></div>
<div class="option-group" style="margin-top:12px"><label style="font-weight:700;">Áreas (marcar):</label>
<div class="areas-actions"><button id="select-all-areas" class="secondary">Seleccionar todo</button><button id="deselect-all-areas" class="secondary">Deseleccionar todo</button></div>
<div class="areas-container" id="areas-list"></div></div>
<div class="option-group" style="margin-top:12px"><label style="font-weight:700;">Configuración del examen:</label>
<div style="margin-top:4px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
<div style="flex:1;min-width:150px"><label for="custom-count">Cantidad de preguntas:</label><br>
<input id="custom-count" type="number" min="1" max="2000" value="50" style="padding:6px;border-radius:6px;border:1px solid rgba(0,0,0,0.08);width:100%;max-width:140px">
<div style="margin-top:4px"><label><input type="checkbox" id="custom-all-questions"> Todas</label></div></div>
<div style="flex:1;min-width:150px"><label for="custom-time">Tiempo total (minutos):</label><br>
<input id="custom-time" type="number" min="1" value="60" style="padding:6px;border-radius:6px;border:1px solid rgba(0,0,0,0.08);width:100%;max-width:140px">
<div style="margin-top:4px"><label><input type="checkbox" id="custom-no-time"> Sin límite de tiempo</label></div></div></div></div></div>
<div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap">
<button class="primary" id="start-btn" data-tooltip="Comenzar" style="flex:1;min-width:120px">Comenzar Quiz</button>
<button class="secondary" id="about-btn" data-tooltip="Acerca de" style="flex:1;min-width:120px">Acerca de</button></div></div></div></div>
<div class="score" id="score-container" style="display:none">Puntaje: <span id="score">0</span> | Pregunta: <span id="current-question">0</span>/<span id="total-questions">0</span></div>
<div class="quiz-card" id="quiz-container" aria-live="polite">
<div class="quiz-toolbar">
<div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap">
<button class="home-btn" id="home-button" title="Reloj (sin acción)" data-tooltip="Reloj" aria-label="Reloj de examen">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="9" stroke="#27456e" stroke-width="1.2"/><path d="M12 7v6l4 2" stroke="#27456e" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
</button>
<div class="timers"><div class="time-box"><small>Initial total</small><div id="initial-total">0m</div></div><div class="time-box"><small>Remaining</small><div id="total-timer">0m 0s</div></div><div class="time-box"><small>Question elapsed</small><div id="question-timer">0m 0s</div></div></div></div>
<div style="color:#27456e;font-weight:700;display:flex;align-items:center;gap:6px;flex-wrap:wrap">
<span id="progress-display"></span><button id="finish-btn" class="secondary" style="padding:6px 8px;border-radius:6px;font-weight:700" data-tooltip="Finalizar">Finalizar cuestionario</button></div></div>
<div class="question" id="question"></div><div class="info" id="q-info"></div><div class="options" id="options" role="list"></div>
<div class="nav-buttons"><button id="prev-btn" class="nav-btn" aria-label="Anterior" data-tooltip="Retroceder"><svg viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
<button id="next-btn" class="nav-btn" aria-label="Siguiente" data-tooltip="Avanzar"><svg viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button></div>
<div id="explanation" aria-live="polite"></div>
<div id="question-area"></div>
</div>
<div class="end-screen" id="end-screen">
<div class="end-actions">
<button id="restart-btn" class="icon-btn" title="Reiniciar quiz" data-tooltip="Reiniciar quiz" aria-label="Reiniciar quiz">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 4v5h-5" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 12a8 8 0 0 1 8-8 8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8z" stroke="#fff" stroke-width="2.5" fill="none"/></svg>
</button>
</div>
<h3 class="results-title">Resultados y estadísticas</h3>
<div class="results-group" id="result-general" style="display:none"><h4>Performance</h4><div class="performance-summary" id="performance-summary"></div></div>
<div class="results-group" id="group-charts" style="display:none"><h4>Gráficos</h4><div class="charts-grid" id="charts-grid"><div class="chart-card"><h4>Desempeño general</h4><canvas id="pieChart"></canvas></div><div class="chart-card"><h4>Exactitud por área</h4><canvas id="barChart"></canvas></div></div></div>
<div class="results-group" id="group-performance" style="display:none"><h4>Estadísticas del intento</h4><div class="stats-box" id="final-stats" style="display:none"></div></div>
<div class="results-group" id="group-history" style="display:none"><h4>Historial</h4><div class="history" id="history-list"></div></div>
<!-- Sección para el historial del usuario -->
<div class="results-group" id="user-history-section" style="display:none">
<h4>Tu Historial Personal</h4>
<div id="user-history-list" class="history">
<p>Inicia sesión para ver tu historial personalizado</p>
</div>
</div>
</div>
<footer>© Pablo Kriger 2026 (Todos los Derechos Reservados)</footer></div>
<!-- Modal para confirmar salida -->
<div class="modal-backdrop" id="exit-backdrop" aria-hidden="true"><div class="modal" role="dialog" aria-modal="true" aria-labelledby="exit-title"><h3 id="exit-title">¿Desea salir?</h3><p>Se borrará el avance actual del quiz. ¿Desea continuar?</p><div class="actions" style="display:flex;gap:12px;justify-content:center;margin-top:16px"><button id="exit-no" class="secondary" style="min-width:100px">NO</button><button id="exit-yes" class="danger-btn" style="min-width:100px">SI</button></div></div></div>
<!-- Modal para confirmar salida desde el botón de inicio -->
<div class="home-exit-backdrop" id="home-exit-backdrop" aria-hidden="true">
  <div class="home-exit-box" role="dialog" aria-modal="true" aria-labelledby="home-exit-title">
    <h3 id="home-exit-title">¿Desea salir?</h3>
    <p>Se borrará el avance actual del quiz. ¿Desea continuar?</p>
    <div class="actions" style="display:flex;gap:12px;justify-content:center;margin-top:16px">
      <button id="home-exit-no" class="secondary" style="min-width:100px">NO</button>
      <button id="home-exit-yes" class="danger-btn" style="min-width:100px">SI</button>
    </div>
  </div>
</div>
<!-- Modal para "Acerca de" actualizado -->
<div class="about-backdrop" id="about-backdrop" aria-hidden="true">
<div class="about-card" role="dialog" aria-modal="true" aria-labelledby="about-title">
  <h3 id="about-title">Acerca de</h3>
  <div class="about-body">
    <div class="about-main">
      <div class="app-title">PMP — Exam Prep</div>
      <div class="app-meta">Versión 1.3</div>
      <div class="copyright">© Pablo Kriger 2026. All rights reserved.</div>
    </div>
    <p class="disclaimer">
      Disclaimer: PMP® y PMBOK® son marcas registradas del Project Management Institute, Inc.
      Este simulador no está afiliado ni avalado por el PMI.
    </p>
  </div>
  <div style="margin-top:16px; text-align:center;"><button id="about-close" class="primary" style="min-width:100px">Cerrar</button></div>
</div>
</div>
<!-- Modal para Consejos PMP -->
<div class="pmp-tips-backdrop" id="pmp-tips-backdrop" aria-hidden="true"><div class="pmp-tips-box" role="dialog" aria-modal="true" aria-labelledby="pmp-tips-title"><h3 id="pmp-tips-title">Consejos PMP</h3>
<div class="pmp-tabs">
<button class="pmp-tab active" data-tab="consejos_PMP">Certificación PMP</button>
<button class="pmp-tab" data-tab="pmbok7_caracteristicas">Sobre el PMBOK7</button>
</div>
<div class="pmp-content" id="pmp-content">Selecciona una categoría para ver contenido</div>
<div class="pmp-actions"><button id="pmp-another" class="secondary">Otro consejo</button><button id="pmp-close" class="primary">Cerrar</button></div></div></div>
<!-- Modal para Mi Progreso -->
<div class="progress-backdrop" id="progress-backdrop" aria-hidden="true"><div class="progress-box" role="dialog" aria-modal="true" aria-labelledby="progress-title"><h3 id="progress-title">Mi Progreso</h3>
<div class="progress-content">
<p>Aquí puedes ver tu progreso en el entrenamiento PMP:</p>
<div class="progress-stats">
<h4>Estadísticas Generales</h4>
<p><strong>Total de quizzes completados:</strong> <span id="total-quizzes">0</span></p>
<p><strong>Promedio de puntaje:</strong> <span id="avg-score">0%</span></p>
<p><strong>Mejor puntaje:</strong> <span id="best-score">0%</span></p>
<p><strong>Tiempo total de estudio:</strong> <span id="total-study-time">0h 0m</span></p>
</div>
<div class="progress-stats">
<h4>Progreso por Áreas</h4>
<p><strong>Áreas dominadas:</strong> <span id="mastered-areas">0</span></p>
<p><strong>Áreas por mejorar:</strong> <span id="improve-areas">0</span></p>
</div>
</div>
<div class="pmp-actions"><button id="progress-close" class="primary">Cerrar</button></div></div></div>
<!-- Modal para confirmar finalización del cuestionario -->
<div class="finish-backdrop" id="finish-backdrop" aria-hidden="true"><div class="finish-box" role="dialog" aria-modal="true" aria-labelledby="finish-title"><h3 id="finish-title">¿Está seguro de que desea finalizar el cuestionario?</h3><div class="actions" style="display:flex;gap:12px;justify-content:center;margin-top:16px"><button id="finish-no" class="secondary" style="min-width:100px">NO</button><button id="finish-yes" class="danger-btn" style="min-width:100px">SI</button></div></div></div>
<div class="timeup-backdrop" id="timeup-backdrop" aria-hidden="true"><div class="timeup-box"><h4>Tiempo finalizado</h4><p>El tiempo del examen ha finalizado. Presione Aceptar para ver las estadísticas.</p><div style="display:flex;justify-content:center;margin-top:12px"><button id="timeup-accept" class="primary">Aceptar</button></div></div></div>
<div id="tooltip" class="tooltip" role="tooltip" aria-hidden="true"></div>
</div>
<script src="app.js"></script>
</body>
</html>